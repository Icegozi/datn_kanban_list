function createBoardCardHtml(board){return `
            <div class="col-md-4 col-lg-3 mb-4 card-drop-target board-card" id="board-card-${board.id}">
                <div class="card shadow-sm h-100 card-hover">
                    <div class="card-body p-3 d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                            <h6 class="mb-0 text-truncate font-weight-bold board-name">${board.name}</h6>
                            <div class="dropdown">
                                <a href="#" class="text-muted dropdown-toggle-no-caret"
                                    id="itemMenu${board.id}" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false" aria-label="T√πy ch·ªçn b·∫£ng">
                                    <i class="fas fa-ellipsis-v"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="itemMenu${board.id}">
                                    <a class="dropdown-item open-board-link" href="${board.url_show}">
                                        <i class="fas fa-folder-open fa-fw mr-2 text-muted"></i>M·ªü
                                    </a>
                                    <a class="dropdown-item rename-board-link" href="#" data-id="${board.id}" data-name="${board.name}" data-update-url="${board.url_update}">
                                        <i class="fas fa-pencil-alt fa-fw mr-2 text-muted"></i>S·ª≠a t√™n
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item delete-board-link text-danger" href="#" data-id="${board.id}" data-name="${board.name}" data-destroy-url="${board.url_destroy}">
                                        <i class="fas fa-trash-alt fa-fw mr-2"></i> Xo√°
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center text-muted small mt-auto board-timestamp">
                            <i class="far fa-clock fa-fw mr-2"></i>
                            <span>${board.updated_at_formatted || board.created_at_formatted}</span>
                        </div>
                    </div>
                </div>
            </div>
        `}
$(document).ready(function(){$.ajaxSetup({headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')}});$('#add-board-btn').on('click',function(){const boardName=prompt("Nh·∫≠p t√™n b·∫£ng m·ªõi:","");if(boardName&&boardName.trim()!==""){$.ajax({url:window.routeUrls.boardsStore,method:'POST',data:{name:boardName.trim()},dataType:'json',success:function(response){console.log("Create Success Response:",response);if(response.success&&response.board){const newBoardHtml=createBoardCardHtml(response.board);$('#no-boards-message').remove();$('#board-list-container').prepend(newBoardHtml);alert(response.message)}else{alert(response.message||'Kh√¥ng th·ªÉ t·∫°o b·∫£ng. Ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá.')}},error:function(xhr){console.error("Create Error XHR:",xhr);let errorMessage='ƒê√£ x·∫£y ra l·ªói khi t·∫°o b·∫£ng.';if(xhr.responseJSON){if(xhr.responseJSON.errors&&xhr.responseJSON.errors.name){errorMessage=xhr.responseJSON.errors.name[0]}else if(xhr.responseJSON.message){errorMessage=xhr.responseJSON.message}}else{errorMessage=`L·ªói kh√¥ng x√°c ƒë·ªãnh (HTTP ${xhr.status}: ${xhr.statusText})`}
console.error("Error response Text:",xhr.responseText);alert(errorMessage)}})}else if(boardName!==null){alert("T√™n b·∫£ng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")}});$('#board-list-container').on('click','.rename-board-link',function(e){e.preventDefault();const boardId=$(this).data('id');const currentName=$(this).data('name');const updateUrl=$(this).data('update-url');$('#renameBoardModal').find('#rename-board-id').val(boardId);$('#renameBoardModal').find('#rename-board-current-name').val(currentName);$('#renameBoardModal').find('#rename-board-new-name').val(currentName);$('#renameBoardModal').find('#rename-board-form').attr('action',updateUrl);$('#renameBoardModal').modal('show');$('#renameBoardModal').on('shown.bs.modal',function(){$('#rename-board-new-name',this).focus().select()}).on('hidden.bs.modal',function(){$(this).off('shown.bs.modal')})});$('#rename-board-form').on('submit',function(e){e.preventDefault();const boardId=$('#rename-board-id').val();const newName=$('#rename-board-new-name').val().trim();const currentName=$('#rename-board-current-name').val();const updateUrl=$(this).attr('action');if(newName&&newName!==currentName){performRenameAjax(boardId,newName,updateUrl)}else if(!newName){alert("T√™n b·∫£ng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")}else{$('#renameBoardModal').modal('hide')}});function performRenameAjax(boardId,newName,updateUrl){$.ajax({url:updateUrl,method:'PUT',data:{name:newName},dataType:'json',success:function(response){console.log("Update Success Response:",response);if(response.success){const $card=$(`#board-card-${boardId}`);$card.find('.board-name').text(response.new_name);$card.find('.rename-board-link').data('name',response.new_name);$card.find('.delete-board-link').data('name',response.new_name);if(response.updated_at_formatted){$card.find('.board-timestamp span').text(response.updated_at_formatted)}
$('#renameBoardModal').modal('hide')}else{alert(response.message||'Kh√¥ng th·ªÉ ƒë·ªïi t√™n b·∫£ng.')}},error:function(xhr){console.error("Update Error XHR:",xhr);let errorMessage='ƒê√£ x·∫£y ra l·ªói khi ƒë·ªïi t√™n b·∫£ng.';if(xhr.responseJSON){if(xhr.responseJSON.errors&&xhr.responseJSON.errors.name){errorMessage=xhr.responseJSON.errors.name[0]}else if(xhr.responseJSON.message){errorMessage=xhr.responseJSON.message}}else{errorMessage=`L·ªói kh√¥ng x√°c ƒë·ªãnh (HTTP ${xhr.status}: ${xhr.statusText})`}
console.error("Error response Text:",xhr.responseText);alert(errorMessage)}})}
$('#board-list-container').on('click','.delete-board-link',function(e){e.preventDefault();const boardId=$(this).data('id');const boardName=$(this).data('name');const destroyUrl=$(this).data('destroy-url');if(confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° b·∫£ng "${boardName}" kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`)){$.ajax({url:destroyUrl,method:'DELETE',dataType:'json',success:function(response){console.log("Delete Success Response:",response);if(response.success){$(`#board-card-${boardId}`).remove();if($('#board-list-container .board-card').length===0){$('#board-list-container').html(`
                                     <div class="col-12" id="no-boards-message">
                                         <p class="text-muted text-center mt-5">B·∫°n ch∆∞a c√≥ b·∫£ng l√†m vi·ªác n√†o. H√£y t·∫°o m·ªôt b·∫£ng m·ªõi!</p>
                                     </div>
                                 `)}
alert(response.message)}else{alert(response.message||'Kh√¥ng th·ªÉ xo√° b·∫£ng.')}},error:function(xhr){console.error("Delete Error XHR:",xhr);let errorMessage='ƒê√£ x·∫£y ra l·ªói khi xo√° b·∫£ng.';if(xhr.responseJSON&&xhr.responseJSON.message){errorMessage=xhr.responseJSON.message}else{errorMessage=`L·ªói kh√¥ng x√°c ƒë·ªãnh (HTTP ${xhr.status}: ${xhr.statusText})`}
console.error("Error response Text:",xhr.responseText);alert(errorMessage)}})}});let isDragging=!1;let offsetX=0,offsetY=0;let ovlTop='40%';let ovlLeft='40%';let $sheepWrapper=$(".sheep-wrapper");if($sheepWrapper.length){let originalPosition={top:$sheepWrapper.css("top"),left:$sheepWrapper.css("left")};if(typeof $.fn.draggable==='function'){$sheepWrapper.draggable({containment:"window",cursor:"grabbing",start:function(event,ui){isDragging=!0},stop:function(event,ui){isDragging=!1;$sheepWrapper.css("cursor","grab");let sheepOffset=ui.helper.offset();let sheepWidth=ui.helper.outerWidth();let sheepHeight=ui.helper.outerHeight();$("#board-list-container .card-drop-target").each(function(){let $card=$(this);let cardOffset=$card.offset();let cardWidth=$card.outerWidth();let cardHeight=$card.outerHeight();let collision=!(sheepOffset.left+sheepWidth<cardOffset.left||sheepOffset.left>cardOffset.left+cardWidth||sheepOffset.top+sheepHeight<cardOffset.top||sheepOffset.top>cardOffset.top+cardHeight);if(collision){console.log("Sheep collided with card:",$card.find('.board-name').text());showOverlayAndHideSheep();return!1}})}})}else{console.warn("jQuery UI Draggable not loaded. Sheep cannot be dragged.")}
function showOverlayAndHideSheep(){$sheepWrapper.hide();if($("#cardOverlay").length===0){$('body').append('<div id="cardOverlay" style="display: none;"></div>');$("#cardOverlay").html(`
                        <div class="overlay-content" id="ovl_content">
                            <p>üéâ C·ª´u ƒë√£ chui v√†o th·∫ª th√†nh c√¥ng!</p>
                        </div>
                    `)}else if($("#cardOverlay .overlay-content").length===0){$("#cardOverlay").html(`
                        <div class="overlay-content" id="ovl_content">
                            <p>üéâ C·ª´u ƒë√£ chui v√†o th·∫ª th√†nh c√¥ng!</p>
                        </div>
                    `)}
$("#ovl_content").css({position:"absolute",top:ovlTop,left:ovlLeft});$("#cardOverlay").fadeIn()}
$(document).on("click","#cardOverlay",function(){$("#cardOverlay").fadeOut(function(){$sheepWrapper.css({top:originalPosition.top,left:originalPosition.left}).show()})});$sheepWrapper.on("click",function(){if(isDragging)return;const $sheep=$(this).find(".sheep");if($sheep.length===0)return;$sheep.stop(!0,!0).css("transform","rotate(0deg)");$({deg:0}).animate({deg:360},{duration:600,easing:'linear',step:function(now){$sheep.css("transform","rotate("+now+"deg)")},complete:function(){$sheep.css("transform","none");const $mouth=$sheep.find(".mouth");if($mouth.length){$mouth.addClass("yawn");setTimeout(()=>$mouth.removeClass("yawn"),800)}}})});const spinInterval=setInterval(function(){const $sheepForInterval=$(".sheep-wrapper .sheep");if($sheepForInterval.length===0){return}
if($sheepForInterval.is(':animated')||!$sheepWrapper.is(':visible')){return}
$sheepForInterval.stop(!0,!0).css("transform","rotate(0deg)");$({deg:0}).animate({deg:360},{duration:1000,easing:'linear',step:function(now){$sheepForInterval.css("transform","rotate("+now+"deg)")},complete:function(){$sheepForInterval.css("transform","none");const $mouthForInterval=$sheepForInterval.find(".mouth");if($mouthForInterval.length){$mouthForInterval.addClass("yawn");setTimeout(()=>$mouthForInterval.removeClass("yawn"),1000)}}})},10000)}else{console.log("Sheep wrapper element not found. Sheep logic skipped.")}})